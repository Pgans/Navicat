[2018-06-20 10:34:53.292] [004041] [samba3] [MYSQL]
SHOW VARIABLES LIKE 'lower_case_%'

[2018-06-20 10:34:53.292] [004041] [samba3] [MYSQL]
SHOW VARIABLES LIKE 'profiling'

[2018-06-20 10:34:53.292] [004041] [samba3] [MYSQL]
SHOW DATABASES

[2018-06-20 10:34:56.516] [004042] [samba3] [MYSQL]
SELECT @@character_set_database, @@collation_database

[2018-06-20 10:34:56.547] [004042] [samba3] [MYSQL]
SHOW FULL TABLES WHERE Table_type != 'VIEW'

[2018-06-20 10:36:16.500] [004044] [samba3] [MYSQL]
SHOW FULL TABLES FROM `dhdc` WHERE Table_type != 'VIEW'

[2018-06-20 10:36:16.515] [004044] [samba3] [MYSQL]
SHOW FULL TABLES FROM `dhdc` WHERE Table_type = 'VIEW'

[2018-06-20 10:36:16.531] [004044] [samba3] [MYSQL]
SHOW PROCEDURE STATUS WHERE Db='dhdc'

[2018-06-20 10:36:16.594] [004044] [samba3] [MYSQL]
SHOW FUNCTION STATUS WHERE Db='dhdc'

[2018-06-20 10:37:26.555] [004042] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type != 'VIEW'

[2018-06-20 10:37:26.555] [004042] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type = 'VIEW'

[2018-06-20 10:37:26.570] [004042] [samba3] [MYSQL]
SHOW PROCEDURE STATUS WHERE Db='mbase_data'

[2018-06-20 10:37:26.648] [004042] [samba3] [MYSQL]
SHOW FUNCTION STATUS WHERE Db='mbase_data'

[2018-06-20 10:38:28.869] [004042] [samba3] [MYSQL]
SHOW COLUMNS FROM `mbase_data`.`opd_diagnosis`

[2018-06-20 10:38:52.164] [004042] [samba3] [MYSQL]
SHOW COLUMNS FROM `mbase_data`.`opd_visits`

[2018-06-20 10:39:50.652] [004042] [samba3] [MYSQL]
SHOW COLUMNS FROM `mbase_data`.`icd10new`

[2018-06-20 10:43:05.412] [004043] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 10:43:05.412] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:43:05.428] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:43:05.455] [004043] [samba3] [MYSQL]
SELECT CURDATE()-1 , c.ICD10_TM, COUNT(DISTINCT a.VISIT_ID) AS AMOUNT
FROM mbase_data.opd_visits a
INNER JOIN mbase_data.opd_diagnosis b ON a.visit_id = b.visit_id AND b.is_cancel = 0
INNER JOIN mbase_data.icd10new c ON b.icd10 = c.icd10 AND c.ICD10_TM = 'F320'
WHERE a.REG_DATETIME > CURDATE()-1

[2018-06-20 10:43:06.973] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:43:06.973] [004043] [samba3] [MYSQL]
SELECT QUERY_ID, SUM(DURATION) AS SUM_DURATION FROM INFORMATION_SCHEMA.PROFILING GROUP BY QUERY_ID;

[2018-06-20 10:43:06.973] [004043] [samba3] [MYSQL]
SELECT STATE AS `Status`, ROUND(SUM(DURATION),7) AS `Duration`, CONCAT(ROUND(SUM(DURATION)/1.514305*100,3), '%') AS `Percentage` FROM INFORMATION_SCHEMA.PROFILING WHERE QUERY_ID=3 GROUP BY STATE;

[2018-06-20 10:43:26.805] [004043] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 10:43:26.805] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:43:26.805] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:43:26.820] [004043] [samba3] [MYSQL]
SELECT CURDATE()-1 , c.ICD10_TM, COUNT(DISTINCT a.VISIT_ID) AS AMOUNT
FROM mbase_data.opd_visits a
INNER JOIN mbase_data.opd_diagnosis b ON a.visit_id = b.visit_id AND b.is_cancel = 0
INNER JOIN mbase_data.icd10new c ON b.icd10 = c.icd10 AND c.ICD10_TM = 'F320'
WHERE a.REG_DATETIME > CURDATE()-1
GROUP BY C.ICD10_TM

[2018-06-20 10:43:26.820] [004043] [samba3] [MYSQL]
1054 - Unknown column 'C.ICD10_TM' in 'group statement'

[2018-06-20 10:43:35.741] [004043] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 10:43:35.741] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:43:35.741] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:43:35.757] [004043] [samba3] [MYSQL]
SELECT CURDATE()-1 , c.ICD10_TM, COUNT(DISTINCT a.VISIT_ID) AS AMOUNT
FROM mbase_data.opd_visits a
INNER JOIN mbase_data.opd_diagnosis b ON a.visit_id = b.visit_id AND b.is_cancel = 0
INNER JOIN mbase_data.icd10new c ON b.icd10 = c.icd10 AND c.ICD10_TM = 'F320'
WHERE a.REG_DATETIME > CURDATE()-1
GROUP BY c.ICD10_TM

[2018-06-20 10:43:35.773] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:43:35.773] [004043] [samba3] [MYSQL]
SELECT QUERY_ID, SUM(DURATION) AS SUM_DURATION FROM INFORMATION_SCHEMA.PROFILING GROUP BY QUERY_ID;

[2018-06-20 10:43:35.773] [004043] [samba3] [MYSQL]
SELECT STATE AS `Status`, ROUND(SUM(DURATION),7) AS `Duration`, CONCAT(ROUND(SUM(DURATION)/0.007570*100,3), '%') AS `Percentage` FROM INFORMATION_SCHEMA.PROFILING WHERE QUERY_ID=14 GROUP BY STATE;

[2018-06-20 10:44:06.526] [004043] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 10:44:06.526] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:44:06.531] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:44:06.539] [004043] [samba3] [MYSQL]
SELECT CURDATE()-1 , c.ICD10_TM, COUNT(DISTINCT a.HN) AS AMOUNT
FROM mbase_data.opd_visits a
INNER JOIN mbase_data.opd_diagnosis b ON a.visit_id = b.visit_id AND b.is_cancel = 0
INNER JOIN mbase_data.icd10new c ON b.icd10 = c.icd10 AND c.ICD10_TM = 'F320'
WHERE a.REG_DATETIME > CURDATE()-1
GROUP BY c.ICD10_TM

[2018-06-20 10:44:06.551] [004043] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:44:06.556] [004043] [samba3] [MYSQL]
SELECT QUERY_ID, SUM(DURATION) AS SUM_DURATION FROM INFORMATION_SCHEMA.PROFILING GROUP BY QUERY_ID;

[2018-06-20 10:44:06.560] [004043] [samba3] [MYSQL]
SELECT STATE AS `Status`, ROUND(SUM(DURATION),7) AS `Duration`, CONCAT(ROUND(SUM(DURATION)/0.007058*100,3), '%') AS `Percentage` FROM INFORMATION_SCHEMA.PROFILING WHERE QUERY_ID=21 GROUP BY STATE;

[2018-06-20 10:50:37.708] [004045] [samba3] [MYSQL]
SELECT @@character_set_database, @@collation_database

[2018-06-20 10:50:42.696] [004045] [samba3] [MYSQL]
SHOW FULL TABLES WHERE Table_type != 'VIEW'

[2018-06-20 10:50:48.532] [004045] [samba3] [MYSQL]
SHOW CREATE TABLE `mb_drug_allergy`

[2018-06-20 10:50:48.688] [004046] [samba3] [MYSQL]
SELECT * FROM `mb_drug_allergy`

[2018-06-20 10:50:48.688] [004046] [samba3] [MYSQL]
SHOW COLUMNS FROM `mbase_data`.`mb_drug_allergy`

[2018-06-20 10:56:32.804] [004052] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type != 'VIEW'

[2018-06-20 10:56:32.815] [004052] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type = 'VIEW'

[2018-06-20 10:56:32.815] [004052] [samba3] [MYSQL]
SHOW PROCEDURE STATUS WHERE Db='mbase_data'

[2018-06-20 10:56:32.888] [004052] [samba3] [MYSQL]
SHOW FUNCTION STATUS WHERE Db='mbase_data'

[2018-06-20 10:56:36.942] [004051] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 10:56:36.942] [004051] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:56:36.948] [004051] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:56:36.948] [004051] [samba3] [MYSQL]
SELECT a.CID, a.FNAME, a.LNAME, a.SEX, a.AGE, b.TOWN_NAME AS 'MOOBAN' , c.TOWN_NAME AS 'TUMBOL',
a.DRUG_NAME, a.ALLERGY_DATE , a.`LEVEL`, a.ALLERGY_NOTE
FROM mb_drug_allergy a, towns b, towns c ,towns d
WHERE a.ALLERGY_DATE BETWEEN '$date1' AND '$date2'
AND a.TOWN_ID = b.TOWN_ID
AND CONCAT(left(a.TOWN_ID,6),'00') = c.TOWN_ID
AND CONCAT(left(a.TOWN_ID,4),'0000') = d.TOWN_ID
GROUP BY a.DRUG_NAME  ORDER BY a.ALLERGY_DATE

[2018-06-20 10:56:36.972] [004051] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:56:36.972] [004051] [samba3] [MYSQL]
SELECT QUERY_ID, SUM(DURATION) AS SUM_DURATION FROM INFORMATION_SCHEMA.PROFILING GROUP BY QUERY_ID;

[2018-06-20 10:56:36.985] [004051] [samba3] [MYSQL]
SELECT STATE AS `Status`, ROUND(SUM(DURATION),7) AS `Duration`, CONCAT(ROUND(SUM(DURATION)/0.007766*100,3), '%') AS `Percentage` FROM INFORMATION_SCHEMA.PROFILING WHERE QUERY_ID=3 GROUP BY STATE;

[2018-06-20 10:58:12.256] [004051] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 10:58:12.256] [004051] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:58:12.256] [004051] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 10:58:12.272] [004051] [samba3] [MYSQL]
SELECT a.CID, a.FNAME, a.LNAME,
 a.SEX, a.AGE, b.TOWN_NAME AS 'MOOBAN' , c.TOWN_NAME AS 'TUMBOL',
a.DRUG_NAME, a.ALLERGY_DATE , a.`LEVEL`, a.ALLERGY_NOTE
FROM mb_drug_allergy a, towns b, towns c ,towns d
WHERE 
#a.ALLERGY_DATE BETWEEN '$date1' AND '$date2'
AND a.TOWN_ID = b.TOWN_ID
AND CONCAT(left(a.TOWN_ID,6),'00') = c.TOWN_ID
AND CONCAT(left(a.TOWN_ID,4),'0000') = d.TOWN_ID
GROUP BY a.DRUG_NAME  ORDER BY a.ALLERGY_DATE

[2018-06-20 10:58:12.272] [004051] [samba3] [MYSQL]
1064 - You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'AND a.TOWN_ID = b.TOWN_ID
AND CONCAT(left(a.TOWN_ID,6),'00') = c.TOWN_ID
AND C' at line 7

[2018-06-20 10:59:24.343] [004054] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type != 'VIEW'

[2018-06-20 10:59:24.359] [004054] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type = 'VIEW'

[2018-06-20 10:59:24.375] [004054] [samba3] [MYSQL]
SHOW PROCEDURE STATUS WHERE Db='mbase_data'

[2018-06-20 10:59:24.437] [004054] [samba3] [MYSQL]
SHOW FUNCTION STATUS WHERE Db='mbase_data'

[2018-06-20 10:59:43.725] [004045] [samba3] [MYSQL]
SHOW PROCEDURE STATUS

[2018-06-20 10:59:43.803] [004045] [samba3] [MYSQL]
SHOW FUNCTION STATUS

[2018-06-20 10:59:46.933] [004045] [samba3] [MYSQL]
SELECT * FROM information_schema.ROUTINES WHERE ROUTINE_SCHEMA='mbase_data' AND ROUTINE_NAME='drug_allergy' AND ROUTINE_TYPE='PROCEDURE' ORDER BY ROUTINE_NAME

[2018-06-20 10:59:46.996] [004045] [samba3] [MYSQL]
SHOW CREATE PROCEDURE `drug_allergy`

[2018-06-20 10:59:47.074] [004055] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type != 'VIEW'

[2018-06-20 10:59:47.074] [004055] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type = 'VIEW'

[2018-06-20 10:59:47.090] [004055] [samba3] [MYSQL]
SHOW PROCEDURE STATUS WHERE Db='mbase_data'

[2018-06-20 10:59:47.168] [004055] [samba3] [MYSQL]
SHOW FUNCTION STATUS WHERE Db='mbase_data'

[2018-06-20 11:00:04.598] [004057] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type != 'VIEW'

[2018-06-20 11:00:04.613] [004057] [samba3] [MYSQL]
SHOW FULL TABLES FROM `mbase_data` WHERE Table_type = 'VIEW'

[2018-06-20 11:00:04.613] [004057] [samba3] [MYSQL]
SHOW PROCEDURE STATUS WHERE Db='mbase_data'

[2018-06-20 11:00:04.691] [004057] [samba3] [MYSQL]
SHOW FUNCTION STATUS WHERE Db='mbase_data'

[2018-06-20 11:02:45.830] [004045] [samba3] [MYSQL]
SHOW COLUMNS FROM `mbase_data`.`towns`

[2018-06-20 11:02:57.429] [004045] [samba3] [MYSQL]
SHOW COLUMNS FROM `mbase_data`.`population`

[2018-06-20 11:04:21.473] [004045] [samba3] [MYSQL]
SHOW COLUMNS FROM `mbase_data`.`cid_drug_allergy`

[2018-06-20 11:04:21.473] [004045] [samba3] [MYSQL]
SHOW COLUMNS FROM `mbase_data`.`drugs`

[2018-06-20 11:10:42.933] [004056] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 11:10:42.933] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:10:42.933] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:10:42.949] [004056] [samba3] [MYSQL]
SELECT DISTINCT a.CID,c.FNAME , c.LNAME ,a.UPD_DT AS ALLERGY_DATE,
CASE 
WHEN c.SEX = 1 THEN 'ชาย'
WHEN c.SEX = 2 THEN 'หญิง'
END AS SEX ,c.BIRTHDATE,FLOOR(DATEDIFF(NOW(),c.BIRTHDATE)/365.25)AS AGE
,c.TOWN_ID, b.DRUG_NAME, c.HOME_ADR, d.TOWN_NAME AS 'MOOBAN', e.TOWN_NAME AS 'TUMBON', f.TOWN_NAME AS 'AMPOR'
CASE
WHEN a.level = 1 THEN 'Unlikely'
WHEN a.level = 2 THEN 'Possible'
WHEN a.level = 3 THEN 'Probable'
WHEN a.level = 4 THEN 'Certain'
END AS LEVEL, a.ALLERGY_NOTE
FROM cid_drug_allergy a, drugs b, population c
INNER JOIN towns d ON d.town_id = c.town_id
INNER JOIN towns e ON CONCAT(left(c.town_id,6),'00') = e.town_id
INNER JOIN towns f ON CONCAT left(c.town_id,4,'0000') = f.town_id
WHERE a.DRUG_ID = b.DRUG_ID
AND a.IS_CANCEL = 0
AND a.CID = c.CID) t;

[2018-06-20 11:10:42.949] [004056] [samba3] [MYSQL]
1064 - You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'CASE
WHEN a.level = 1 THEN 'Unlikely'
WHEN a.level = 2 THEN 'Possible'
WHEN a' at line 7

[2018-06-20 11:10:55.483] [004056] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 11:10:55.483] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:10:55.499] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:10:55.499] [004056] [samba3] [MYSQL]
SELECT DISTINCT a.CID,c.FNAME , c.LNAME ,a.UPD_DT AS ALLERGY_DATE,
CASE 
WHEN c.SEX = 1 THEN 'ชาย'
WHEN c.SEX = 2 THEN 'หญิง'
END AS SEX ,c.BIRTHDATE,FLOOR(DATEDIFF(NOW(),c.BIRTHDATE)/365.25)AS AGE
,c.TOWN_ID, b.DRUG_NAME, c.HOME_ADR, d.TOWN_NAME AS 'MOOBAN', e.TOWN_NAME AS 'TUMBON', f.TOWN_NAME AS 'AMPOR'
CASE
WHEN a.level = 1 THEN 'Unlikely'
WHEN a.level = 2 THEN 'Possible'
WHEN a.level = 3 THEN 'Probable'
WHEN a.level = 4 THEN 'Certain'
END AS LEVEL, a.ALLERGY_NOTE
FROM cid_drug_allergy a, drugs b, population c
INNER JOIN towns d ON d.town_id = c.town_id
INNER JOIN towns e ON CONCAT(left(c.town_id,6),'00') = e.town_id
INNER JOIN towns f ON CONCAT left(c.town_id,4,'0000') = f.town_id
WHERE a.DRUG_ID = b.DRUG_ID
AND a.IS_CANCEL = 0
AND a.CID = c.CID

[2018-06-20 11:10:55.499] [004056] [samba3] [MYSQL]
1064 - You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'CASE
WHEN a.level = 1 THEN 'Unlikely'
WHEN a.level = 2 THEN 'Possible'
WHEN a' at line 7

[2018-06-20 11:12:10.344] [004056] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 11:12:10.344] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:12:10.359] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:12:10.359] [004056] [samba3] [MYSQL]
SELECT DISTINCT a.CID,c.FNAME , c.LNAME ,a.UPD_DT AS ALLERGY_DATE,
CASE 
WHEN c.SEX = 1 THEN 'ชาย'
WHEN c.SEX = 2 THEN 'หญิง'
END AS SEX ,c.BIRTHDATE,FLOOR(DATEDIFF(NOW(),c.BIRTHDATE)/365.25)AS AGE
,c.TOWN_ID, b.DRUG_NAME, 
CASE
WHEN a.level = 1 THEN 'Unlikely'
WHEN a.level = 2 THEN 'Possible'
WHEN a.level = 3 THEN 'Probable'
WHEN a.level = 4 THEN 'Certain'
END AS LEVEL, a.ALLERGY_NOTE, c.HOME_ADR, d.TOWN_NAME AS 'MOOBAN', e.TOWN_NAME AS 'TUMBON', f.TOWN_NAME AS 'AMPOR'
FROM cid_drug_allergy a, drugs b, population c
INNER JOIN towns d ON d.town_id = c.town_id
INNER JOIN towns e ON CONCAT(left(c.town_id,6),'00') = e.town_id
INNER JOIN towns f ON CONCAT left(c.town_id,4,'0000') = f.town_id
WHERE a.DRUG_ID = b.DRUG_ID
AND a.IS_CANCEL = 0
AND a.CID = c.CID

[2018-06-20 11:12:10.359] [004056] [samba3] [MYSQL]
1064 - You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '(c.town_id,4,'0000') = f.town_id
WHERE a.DRUG_ID = b.DRUG_ID
AND a.IS_CANCEL =' at line 16

[2018-06-20 11:12:37.945] [004056] [samba3] [MYSQL]
SET PROFILING=1;

[2018-06-20 11:12:37.945] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:12:37.945] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:12:37.960] [004056] [samba3] [MYSQL]
SELECT DISTINCT a.CID,c.FNAME , c.LNAME ,a.UPD_DT AS ALLERGY_DATE,
CASE 
WHEN c.SEX = 1 THEN 'ชาย'
WHEN c.SEX = 2 THEN 'หญิง'
END AS SEX ,c.BIRTHDATE,FLOOR(DATEDIFF(NOW(),c.BIRTHDATE)/365.25)AS AGE
,c.TOWN_ID, b.DRUG_NAME, 
CASE
WHEN a.level = 1 THEN 'Unlikely'
WHEN a.level = 2 THEN 'Possible'
WHEN a.level = 3 THEN 'Probable'
WHEN a.level = 4 THEN 'Certain'
END AS LEVEL, a.ALLERGY_NOTE, c.HOME_ADR, d.TOWN_NAME AS 'MOOBAN', e.TOWN_NAME AS 'TUMBON', f.TOWN_NAME AS 'AMPOR'
FROM cid_drug_allergy a, drugs b, population c
INNER JOIN towns d ON d.town_id = c.town_id
INNER JOIN towns e ON CONCAT(left(c.town_id,6),'00') = e.town_id
INNER JOIN towns f ON CONCAT (left(c.town_id,4),'0000') = f.town_id
WHERE a.DRUG_ID = b.DRUG_ID
AND a.IS_CANCEL = 0
AND a.CID = c.CID

[2018-06-20 11:12:38.164] [004056] [samba3] [MYSQL]
SHOW STATUS

[2018-06-20 11:12:38.164] [004056] [samba3] [MYSQL]
SELECT QUERY_ID, SUM(DURATION) AS SUM_DURATION FROM INFORMATION_SCHEMA.PROFILING GROUP BY QUERY_ID;

[2018-06-20 11:12:38.164] [004056] [samba3] [MYSQL]
SELECT STATE AS `Status`, ROUND(SUM(DURATION),7) AS `Duration`, CONCAT(ROUND(SUM(DURATION)/0.182956*100,3), '%') AS `Percentage` FROM INFORMATION_SCHEMA.PROFILING WHERE QUERY_ID=15 GROUP BY STATE;

[2018-06-20 11:13:12.600] [004059] [samba3] [MYSQL]
SELECT DISTINCT a.CID,c.FNAME , c.LNAME ,a.UPD_DT AS ALLERGY_DATE,
CASE 
WHEN c.SEX = 1 THEN 'ชาย'
WHEN c.SEX = 2 THEN 'หญิง'
END AS SEX ,c.BIRTHDATE,FLOOR(DATEDIFF(NOW(),c.BIRTHDATE)/365.25)AS AGE
,c.TOWN_ID, b.DRUG_NAME, 
CASE
WHEN a.level = 1 THEN 'Unlikely'
WHEN a.level = 2 THEN 'Possible'
WHEN a.level = 3 THEN 'Probable'
WHEN a.level = 4 THEN 'Certain'
END AS LEVEL, a.ALLERGY_NOTE, c.HOME_ADR, d.TOWN_NAME AS 'MOOBAN', e.TOWN_NAME AS 'TUMBON', f.TOWN_NAME AS 'AMPOR'
FROM cid_drug_allergy a, drugs b, population c
INNER JOIN towns d ON d.town_id = c.town_id
INNER JOIN towns e ON CONCAT(left(c.town_id,6),'00') = e.town_id
INNER JOIN towns f ON CONCAT (left(c.town_id,4),'0000') = f.town_id
WHERE a.DRUG_ID = b.DRUG_ID
AND a.IS_CANCEL = 0
AND a.CID = c.CID

